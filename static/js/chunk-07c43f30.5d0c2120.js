(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07c43f30"],{"43fe":function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return i}));s("d9e2"),s("d3b7");var r=s("b775");function a(e){return Object(r["a"])({url:"/production/process/list",method:"get",params:e})}function n(e){return Object(r["a"])({url:"/production/process",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/production/process",method:"put",data:e})}},"5e84":function(e,t,s){"use strict";s("b82d")},"6a5f":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0}},[s("el-form-item",{attrs:{label:"流程名称",prop:"processName"}},[s("el-input",{attrs:{placeholder:"请输入流程名称",clearable:""},model:{value:e.queryParams.processName,callback:function(t){e.$set(e.queryParams,"processName",t)},expression:"queryParams.processName"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("搜索")]),s("el-button",{on:{click:e.resetQuery}},[e._v("重置")])],1)],1),s("el-row",{staticClass:"mb8",attrs:{gutter:10}},[s("el-col",{attrs:{span:2}},[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["production:process:add"],expression:"['production:process:add']"}],attrs:{type:"primary",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),s("el-col",{attrs:{span:2}},[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["production:process:edit"],expression:"['production:process:edit']"}],attrs:{type:"success",size:"mini",disabled:e.single},on:{click:e.handleUpdate}},[e._v("修改")])],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.processList},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),s("el-table-column",{attrs:{label:"流程名称",align:"center",prop:"processName"}}),s("el-table-column",{attrs:{label:"流程步骤",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.renderSteps(t.row)))])]}}])}),s("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),s("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:1===t.row.status?"success":"info"}},[e._v(e._s(1===t.row.status?"启用":"禁用"))])]}}])}),s("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),s("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["production:process:edit"],expression:"['production:process:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(s){return e.handleUpdate(t.row)}}},[e._v("修改")]),1!==t.row.status?s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["production:process:edit"],expression:"['production:process:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-circle-check"},on:{click:function(s){return e.handleEnable(t.row)}}},[e._v("启用")]):e._e(),1===t.row.status?s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["production:process:edit"],expression:"['production:process:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-close"},on:{click:function(s){return e.handleDisable(t.row)}}},[e._v("禁用")]):e._e()]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),s("el-dialog",{attrs:{title:e.title,visible:e.open,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"流程名称",prop:"processName"}},[s("el-input",{attrs:{placeholder:"请输入流程名称"},model:{value:e.form.processName,callback:function(t){e.$set(e.form,"processName",t)},expression:"form.processName"}})],1),s("el-form-item",{attrs:{label:"流程步骤",prop:"steps"}},[s("div",[s("el-input",{staticStyle:{width:"360px"},attrs:{placeholder:"输入节点名称后回车或点击添加"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addStep(t)}},model:{value:e.stepInput,callback:function(t){e.stepInput=t},expression:"stepInput"}}),s("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",size:"mini"},on:{click:e.addStep}},[e._v("添加节点")])],1),s("draggable",{staticStyle:{"margin-top":"10px"},attrs:{options:{animation:150,ghostClass:"drag-ghost"}},model:{value:e.form.steps,callback:function(t){e.$set(e.form,"steps",t)},expression:"form.steps"}},e._l(e.form.steps,(function(t,r){return s("div",{key:r,staticClass:"step-item"},[s("i",{staticClass:"el-icon-rank drag-handle",attrs:{title:"拖拽排序"}}),s("el-tag",{staticClass:"step-tag",attrs:{closable:""},on:{close:function(t){return e.removeStep(r)}}},[e._v(e._s(t))])],1)})),0)],1),s("el-form-item",{attrs:{label:"备注",prop:"remark"}},[s("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),s("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)],1)},a=[],n=(s("4de4"),s("a15b"),s("d81d"),s("14d9"),s("a434"),s("e9c4"),s("b64b"),s("d3b7"),s("ac1f"),s("1276"),s("498a"),s("0643"),s("2382"),s("a573"),s("43fe")),i=s("b76a"),o=s.n(i),l={name:"ProductionProcess",components:{draggable:o.a},data:function(){return{loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,processList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,processName:null},form:{},stepInput:"",rules:{processName:[{required:!0,message:"流程名称不能为空",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(n["b"])(this.queryParams).then((function(t){e.processList=t.rows,e.total=t.total,e.loading=!1}))},renderSteps:function(e){if(!e||!e.processSteps)return"";try{var t=JSON.parse(e.processSteps);if(Array.isArray(t))return t.join(" - ")}catch(r){}var s=String(e.processSteps||"").trim();return s?s.split(/[\,\-\n]/).map((function(e){return e.trim()})).filter(Boolean).join(" - "):""},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.processId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="新增生产流程"},handleUpdate:function(e){this.reset();var t=Object.assign({},e||{}),s=[];if(t.processSteps){try{s=JSON.parse(t.processSteps)||[]}catch(r){}Array.isArray(s)&&s.length||(s=String(t.processSteps).split(/[,\-\n]/).map((function(e){return e.trim()})).filter(Boolean))}t.steps=s,this.form=t,this.open=!0,this.title="修改生产流程"},handleEnable:function(e){var t=this,s=e.processId;Object(n["c"])({processId:s,status:1}).then((function(){t.$modal.msgSuccess("已启用"),t.getList()}))},handleDisable:function(e){var t=this,s=e.processId;Object(n["c"])({processId:s,status:0}).then((function(){t.$modal.msgSuccess("已禁用"),t.getList()}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={processId:null,processName:null,steps:[],remark:null},this.stepInput="",this.resetForm("form")},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){if(t){var s=Object.assign({status:1},e.form);Array.isArray(s.steps)&&(s.processSteps=JSON.stringify(s.steps)),delete s.steps;var r=e.form.processId?n["c"]:n["a"];r(s).then((function(){e.$modal.msgSuccess("保存成功"),e.open=!1,e.getList()}))}}))},addStep:function(){var e=(this.stepInput||"").trim();e&&(this.form.steps||(this.form.steps=[]),this.form.steps.push(e),this.stepInput="")},removeStep:function(e){Array.isArray(this.form.steps)&&this.form.steps.splice(e,1)}}},c=l,p=(s("5e84"),s("2877")),u=Object(p["a"])(c,r,a,!1,null,"41786a26",null);t["default"]=u.exports},b82d:function(e,t,s){}}]);