(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-190616c0"],{1511:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"a",(function(){return i})),t.d(n,"c",(function(){return a}));var r=t("b775");function o(e){return Object(r["a"])({url:"/warehouseWarrant/warehouseWarrant/list",method:"get",params:e})}function i(e){return Object(r["a"])({url:"/warehouseWarrant/warehouseWarrant",method:"post",data:e})}function a(e){return Object(r["a"])({url:"/warehouseWarrant/warehouseWarrant",method:"put",data:e})}},2246:function(e,n){},"284a":function(e,n,t){"use strict";t.r(n);var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"app-container"},[t("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[t("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[t("el-input",{attrs:{placeholder:"请输入"+e.inventoryNameLabel,clearable:""},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.handleQuery(n)}},model:{value:e.queryParams.inventoryName,callback:function(n){e.$set(e.queryParams,"inventoryName",n)},expression:"queryParams.inventoryName"}})],1),t("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[t("el-input",{attrs:{placeholder:"请输入数量",clearable:""},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.handleQuery(n)}},model:{value:e.queryParams.inventoryNum,callback:function(n){e.$set(e.queryParams,"inventoryNum",n)},expression:"queryParams.inventoryNum"}})],1),t("el-form-item",{attrs:{label:"价格",prop:"inventoryPrice"}},[t("el-input",{attrs:{placeholder:"请输入价格",clearable:""},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.handleQuery(n)}},model:{value:e.queryParams.inventoryPrice,callback:function(n){e.$set(e.queryParams,"inventoryPrice",n)},expression:"queryParams.inventoryPrice"}})],1),t("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[t("el-input",{attrs:{placeholder:"请输入单位",clearable:""},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.handleQuery(n)}},model:{value:e.queryParams.inventoryUnit,callback:function(n){e.$set(e.queryParams,"inventoryUnit",n)},expression:"queryParams.inventoryUnit"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),t("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),t("el-row",{staticClass:"mb8",attrs:{gutter:10}},[t("el-col",{attrs:{span:2}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:add"],expression:"['Inventory:inventory:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-shopping-cart-full",size:"mini"},on:{click:e.handleProcurementAdd}},[e._v("采购入库")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:add"],expression:"['Inventory:inventory:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-finished",size:"mini"},on:{click:e.handleProductionAdd}},[e._v("完工入库")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:add"],expression:"['Inventory:inventory:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-collection",size:"mini"},on:{click:e.handleSemiFinishedAdd}},[e._v("半成品入库")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:edit"],expression:"['Inventory:inventory:edit']"}],attrs:{type:"success",plain:"",icon:"el-icon-edit",size:"mini",disabled:e.single},on:{click:e.handleUpdate}},[e._v("修改")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:remove"],expression:"['Inventory:inventory:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("删除")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:export"],expression:"['Inventory:inventory:export']"}],attrs:{type:"warning",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleExport}},[e._v("导出")])],1),t("right-toolbar",{attrs:{"show-search":e.showSearch},on:{"update:showSearch":function(n){e.showSearch=n},"update:show-search":function(n){e.showSearch=n},queryTable:e.getList}})],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.inventoryList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{label:e.inventoryNameLabel,align:"center",prop:"inventoryName"}}),t("el-table-column",{attrs:{label:"数量",align:"center",prop:"inventoryNum"}}),t("el-table-column",{attrs:{label:"价格",align:"center",prop:"inventoryPrice"}}),t("el-table-column",{attrs:{label:"单位",align:"center",prop:"inventoryUnit"}}),t("el-table-column",{attrs:{label:"类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(e._s(e.typeName(n.row)))])]}}])}),t("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),t("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:edit"],expression:"['Inventory:inventory:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.handleUpdate(n.row)}}},[e._v("修改")]),t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:remove"],expression:"['Inventory:inventory:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete(n.row)}}},[e._v("删除")]),t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:pull"],expression:"['Inventory:inventory:pull']"}],attrs:{size:"mini",type:"text",icon:"el-icon-s-claim"},on:{click:function(t){return e.handlePull(n.row)}}},[e._v("申领")]),t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:query"],expression:"['Inventory:inventory:query']"}],attrs:{size:"mini",type:"text",icon:"el-icon-time"},on:{click:function(t){return e.handleHistory(n.row)}}},[e._v("查看历史")])]}}])})],1),t("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(n){return e.$set(e.queryParams,"pageNum",n)},"update:limit":function(n){return e.$set(e.queryParams,"pageSize",n)},pagination:e.getList}}),t("el-dialog",{attrs:{title:e.title,visible:e.openPull,width:"520px","append-to-body":""},on:{"update:visible":function(n){e.openPull=n}}},[t("el-form",{ref:"form",attrs:{model:e.formPull,rules:e.rulesPull,"label-width":"102px"}},[t("el-form-item",{attrs:{label:"出库类型",prop:"outType"}},[t("el-radio-group",{model:{value:e.formPull.outType,callback:function(n){e.$set(e.formPull,"outType",n)},expression:"formPull.outType"}},[t("el-radio",{attrs:{label:1}},[e._v("生产领料")]),t("el-radio",{attrs:{label:2}},[e._v("调拨出库")])],1)],1),1===e.formPull.outType?t("el-form-item",{attrs:{label:"生产单",prop:"productionPlanId"}},[t("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"","remote-method":e.remoteSearchPullProduction,loading:e.pullProductionLoading,placeholder:"搜索生产单号或计划名称"},on:{change:e.onPullProductionChange},model:{value:e.formPull.productionPlanId,callback:function(n){e.$set(e.formPull,"productionPlanId",n)},expression:"formPull.productionPlanId"}},e._l(e.pullProductionOptions,(function(e){return t("el-option",{key:e.planId,attrs:{label:(e.workOrderNo?e.workOrderNo+" - ":"")+(e.planName||""),value:e.planId}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入数量",disabled:1===e.formPull.outType&&e.lockPullByProductionPlan},model:{value:e.formPull.inventoryNum,callback:function(n){e.$set(e.formPull,"inventoryNum",n)},expression:"formPull.inventoryNum"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.submitFormPull}},[e._v("确 定")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(n){e.open=n}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[t("el-input",{attrs:{placeholder:"请输入"+e.inventoryNameLabel},model:{value:e.form.inventoryName,callback:function(n){e.$set(e.form,"inventoryName",n)},expression:"form.inventoryName"}})],1),t("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[t("el-input",{attrs:{placeholder:"请输入数量"},model:{value:e.form.inventoryNum,callback:function(n){e.$set(e.form,"inventoryNum",n)},expression:"form.inventoryNum"}})],1),t("el-form-item",{attrs:{label:"价格",prop:"inventoryPrice"}},[t("el-input",{attrs:{placeholder:"请输入价格"},model:{value:e.form.inventoryPrice,callback:function(n){e.$set(e.form,"inventoryPrice",n)},expression:"form.inventoryPrice"}})],1),t("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[t("el-input",{attrs:{placeholder:"请输入单位"},model:{value:e.form.inventoryUnit,callback:function(n){e.$set(e.form,"inventoryUnit",n)},expression:"form.inventoryUnit"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(n){e.$set(e.form,"remark",n)},expression:"form.remark"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:e.procurementTitle,visible:e.openProcurement,width:"500px","append-to-body":""},on:{"update:visible":function(n){e.openProcurement=n}}},[t("el-form",{ref:"procurementFormRef",attrs:{model:e.procurementForm,rules:e.procurementRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"运输单号",prop:"inboundShippingQuery"}},[t("el-autocomplete",{attrs:{placeholder:"请选择运单号","fetch-suggestions":e.fetchInboundShippingSuggestions,debounce:300,"trigger-on-focus":!0,"prefix-icon":"el-icon-tickets"},on:{select:e.onInboundShippingSelect},model:{value:e.procurementForm.inboundShippingQuery,callback:function(n){e.$set(e.procurementForm,"inboundShippingQuery",n)},expression:"procurementForm.inboundShippingQuery"}})],1),t("el-form-item",{attrs:{label:"采购单"}},[t("el-autocomplete",{attrs:{placeholder:"输入采购计划名称或采购单号","fetch-suggestions":e.fetchProcurementPlanSuggestions,debounce:300,"trigger-on-focus":!0,disabled:!0},on:{select:e.onProcurementSuggestionSelect},model:{value:e.poSearch,callback:function(n){e.poSearch=n},expression:"poSearch"}})],1),t("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[t("el-input",{attrs:{placeholder:"自动带入",disabled:e.lockedByPlan},model:{value:e.procurementForm.inventoryName,callback:function(n){e.$set(e.procurementForm,"inventoryName",n)},expression:"procurementForm.inventoryName"}})],1),t("el-form-item",{attrs:{label:"价格",prop:"inventoryPrice"}},[t("el-input",{attrs:{placeholder:"自动带入",disabled:""},model:{value:e.procurementForm.inventoryPrice,callback:function(n){e.$set(e.procurementForm,"inventoryPrice",n)},expression:"procurementForm.inventoryPrice"}})],1),t("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[t("el-input",{attrs:{placeholder:"自动带入",disabled:e.lockedByPlan},model:{value:e.procurementForm.inventoryNum,callback:function(n){e.$set(e.procurementForm,"inventoryNum",n)},expression:"procurementForm.inventoryNum"}})],1),t("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[t("el-input",{attrs:{placeholder:"自动带入",disabled:e.lockedByPlan},model:{value:e.procurementForm.inventoryUnit,callback:function(n){e.$set(e.procurementForm,"inventoryUnit",n)},expression:"procurementForm.inventoryUnit"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.procurementForm.remark,callback:function(n){e.$set(e.procurementForm,"remark",n)},expression:"procurementForm.remark"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.procurementSubmitting},on:{click:e.submitProcurementForm}},[e._v("确 定")]),t("el-button",{on:{click:e.cancelProcurement}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:e.productionTitle,visible:e.openProduction,width:"500px","append-to-body":""},on:{"update:visible":function(n){e.openProduction=n}}},[t("el-form",{ref:"productionFormRef",attrs:{model:e.productionForm,rules:e.productionRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"生产单"}},[t("el-autocomplete",{attrs:{placeholder:"输入生产计划名称或生产单号","fetch-suggestions":e.fetchProductionPlanSuggestions,debounce:300,"trigger-on-focus":!0},on:{select:e.onProductionSuggestionSelect},model:{value:e.prodSearch,callback:function(n){e.prodSearch=n},expression:"prodSearch"}})],1),t("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[t("el-input",{attrs:{placeholder:"自动带入",disabled:e.lockedByProductionPlan},model:{value:e.productionForm.inventoryName,callback:function(n){e.$set(e.productionForm,"inventoryName",n)},expression:"productionForm.inventoryName"}})],1),t("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[t("el-input-number",{attrs:{min:1,step:1,"controls-position":"right",placeholder:"自动带入",disabled:e.lockedByProductionPlan},model:{value:e.productionForm.inventoryNum,callback:function(n){e.$set(e.productionForm,"inventoryNum",n)},expression:"productionForm.inventoryNum"}})],1),t("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[t("el-input",{attrs:{placeholder:"自动带入",disabled:e.lockedByProductionPlan},model:{value:e.productionForm.inventoryUnit,callback:function(n){e.$set(e.productionForm,"inventoryUnit",n)},expression:"productionForm.inventoryUnit"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.productionForm.remark,callback:function(n){e.$set(e.productionForm,"remark",n)},expression:"productionForm.remark"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.productionSubmitting},on:{click:e.submitProductionForm}},[e._v("确 定")]),t("el-button",{on:{click:e.cancelProduction}},[e._v("取 消")])],1)],1)],1)},o=[],i=t("5530"),a=t("3835"),l=(t("d9e2"),t("99af"),t("4de4"),t("7db0"),t("a630"),t("caad"),t("a15b"),t("d81d"),t("fb6a"),t("4e82"),t("a9e3"),t("f00c"),t("d3b7"),t("ac1f"),t("00b4"),t("6062"),t("2532"),t("3ca3"),t("498a"),t("0643"),t("2382"),t("fffc"),t("a573"),t("ddb0"),t("8da2")),u=t("fba1"),c=t("1511"),s=t("8d7a"),m=t("e988"),p=t("2d7b"),d=t("2224"),h=t("b3a9"),y={name:"Inventory",data:function(){var e=this;return{openPull:!1,formPull:{inventoryId:0,inventoryName:"",inventoryUnit:"",outType:1,productionPlanId:null},loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,inventoryList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,inventoryName:null,inventoryNum:null,inventoryPrice:null,inventoryUnit:null,warehouseWarrantId:null},form:{},rules:{},rulesPull:{outType:[{required:!0,message:"请选择出库类型",trigger:"change"}],inventoryNum:[{required:!0,message:"请输入数量",trigger:"blur"}]},openProcurement:!1,procurementTitle:"",procurementPlanOptions:[],procurementPlanLoading:!1,selectedProcurementPlanId:null,poSearch:"",lockedByPlan:!0,procurementForm:{},procurementSubmitting:!1,procurementRules:{inboundShippingQuery:[{required:!0,message:"请选择运输单",trigger:"change"},{validator:function(n,t,r){e.selectedInboundShippingTrackingNo?r():r(new Error("请选择运输单"))},trigger:"change"}]},inboundShippingQuery:"",selectedInboundShippingTrackingNo:"",selectedInboundShippingPO:"",lockPOByShipping:!1,openProduction:!1,productionTitle:"",productionPlanOptions:[],productionPlanLoading:!1,selectedProductionPlanId:null,prodSearch:"",lockedByProductionPlan:!0,productionForm:{},productionRules:{inventoryNum:[{required:!0,message:"请输入数量",trigger:"blur"},{validator:function(e,n,t){var r=Number(n);!Number.isFinite(r)||r<=0?t(new Error("数量必须为正整数")):t()},trigger:"blur"}]},productionSubmitting:!1,pullProductionOptions:[],pullProductionLoading:!1,lockPullByProductionPlan:!1,materialsClassifyOptions:[],typeNameDict:{}}},created:function(){this.getList(),this.fetchTypeDictionaries()},computed:{inventoryNameLabel:function(){var e=this.$route||{},n=String(e.path||""),t=e.query&&e.query.module,r=e.meta&&e.meta.module,o=t||r||(/(production|supplier)/i.test(n)?"production":/(warehouse)/i.test(n)?"warehouse":null);return"production"===o?"供应商库存名称":"库存名称"},inventoryPageTitle:function(){var e=this.inventoryNameLabel;return"供应商库存名称"===e?"供应商库存列表":"库存列表"}},methods:{$_addWarehouseDelivery:function(e){e&&e.warehouseDeliveryName&&e.warehouseDeliveryNum&&Object(u["a"])(e).catch((function(){}))},submitFormPull:function(){var e=this,n=Number(this.formPull.inventoryNum||0),t=Number(this.formPull.currentNum||0);if(this.formPull.inventoryId)if(1!==this.formPull.outType||this.formPull.productionPlanId)if(!Number.isFinite(n)||n<=0)this.$modal.msgError("请输入有效申领数量");else if(n>t)this.$modal.msgError("申领数量不能大于当前库存");else{var r={inventoryId:this.formPull.inventoryId,inventoryNum:t-n,remark:["出库类型:".concat(1===this.formPull.outType?"生产出库":"调拨出库")].join(" | ")};Object(l["h"])(r).then((function(){var t=["OUT","类型:".concat(1===e.formPull.outType?"生产出库":"调拨出库")].join(" | "),r={warehouseDeliveryName:e.formPull.inventoryName,warehouseDeliveryNum:n,unit:e.formPull.inventoryUnit,remark:t};try{e.$_addWarehouseDelivery&&e.$_addWarehouseDelivery(r)}catch(o){}e.$modal.msgSuccess("申请成功"),e.openPull=!1,e.getList()}))}else this.$modal.msgError("请选择生产单");else this.$modal.msgError("缺少申领目标ID")},handlePull:function(e){this.formPull.inventoryId=e.inventoryId,this.formPull.inventoryName=e.inventoryName,this.formPull.inventoryUnit=e.inventoryUnit,this.formPull.currentNum=e.inventoryNum,this.formPull.inventoryNum=null,this.formPull.outType=1,this.formPull.productionPlanId=null,this.pullProductionOptions=[],this.lockPullByProductionPlan=!1,this.openPull=!0,this.title="申领窗口"},remoteSearchPullProduction:function(e){var n=this;e?(this.pullProductionLoading=!0,Object(m["d"])({planName:e,workOrderNo:e,status:1,pageNum:1,pageSize:10}).then((function(e){var t=e.rows||[];n.pullProductionOptions=t.filter((function(e){return 1===e.status}))})).catch((function(){})).finally((function(){n.pullProductionLoading=!1}))):this.pullProductionOptions=[]},onPullProductionChange:function(e){var n=this.pullProductionOptions.find((function(n){return n.planId===e}));n?(this.formPull.inventoryNum=n.productionNum,this.lockPullByProductionPlan=!0):this.lockPullByProductionPlan=!1},getList:function(){var e=this;this.loading=!0,Object(l["g"])(this.queryParams).then((function(n){var t=n.rows||[];e.inventoryList=t,e.total=n.total,e.resolveTypeNames(e.inventoryList),e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={inventoryId:null,inventoryName:null,inventoryNum:null,inventoryPrice:null,inventoryUnit:null,warehouseWarrantId:null,remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.inventoryId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加"+this.inventoryPageTitle},handleProcurementAdd:function(){this.resetProcurementForm(),this.openProcurement=!0,this.procurementTitle="采购入库",this.remoteSearchInboundPO("")},handleProductionAdd:function(){this.resetProductionForm(),this.openProduction=!0,this.productionTitle="生产入库",this.fetchProductionPlans()},remoteSearchInboundPO:function(e){var n=this,t=(e||"").trim();this.procurementPlanLoading=!0;var r=t?{auditStatus:2,procurementPlanName:t,purchaseOrderNo:t,pageNum:1,pageSize:9999}:{auditStatus:2,pageNum:1,pageSize:9999};Object(s["g"])(r).then((function(e){n.procurementPlanOptions=e.rows||[]})).finally((function(){n.procurementPlanLoading=!1}))},onInboundPOVisibleChange:function(e){e&&this.remoteSearchInboundPO("")},onProcurementPlanChange:function(e){var n=this,t=this.procurementPlanOptions.find((function(n){return n.procurementPlanId===e}));if(this.lockedByPlan=!!e,t){this.procurementForm.inventoryNum=t.procurementPlanNum||this.procurementForm.inventoryNum,this.procurementForm.inventoryPrice=t.procurementPlanPrice||this.procurementForm.inventoryPrice;var r=t.lpMaterialId;this.procurementForm.materialsId=r||null,r?Object(p["a"])(r).then((function(e){var r=e&&e.data?e.data:{};n.procurementForm.inventoryName=r.accessoryName||n.procurementForm.inventoryName,n.procurementForm.inventoryUnit=t.unit||r.unit||n.procurementForm.inventoryUnit})):this.procurementForm.inventoryUnit=t.unit||this.procurementForm.inventoryUnit}},submitProcurementForm:function(){var e=this;this.procurementSubmitting||this.$refs["procurementFormRef"].validate((function(n){if(n){e.procurementSubmitting=!0;var t=e.procurementForm.materialsId?"ITEM#".concat(e.procurementForm.materialsId):null,r=e.procurementForm.remark,o=e.selectedInboundShippingTrackingNo?"SHIP#".concat(e.selectedInboundShippingTrackingNo):null,i=e.selectedInboundShippingPO?"PO#".concat(e.selectedInboundShippingPO):null,a=[t,o,i,r].filter(Boolean).join(" | "),u={inventoryName:e.procurementForm.inventoryName,inventoryNum:e.procurementForm.inventoryNum,inventoryPrice:e.procurementForm.inventoryPrice,inventoryUnit:e.procurementForm.inventoryUnit,remark:a,warehouseWarrantId:e.selectedProcurementPlanId,itemId:e.procurementForm.materialsId||null};Object(l["a"])(u).then((function(){var n={warehouseWarrantName:e.procurementForm.inventoryName,warehouseWarrantNum:e.procurementForm.inventoryNum,warehouseWarrantPrice:e.procurementForm.inventoryPrice,unit:e.procurementForm.inventoryUnit,remark:a};Object(c["a"])(n).catch((function(){})),e.resetQuery();var t=e.selectedProcurementPlanId;t?Object(s["c"])({procurementPlanId:t}).then((function(){e.$modal.msgSuccess("新增成功，并已到货"),e.openProcurement=!1,e.resetQuery()})).catch((function(){e.$modal.msgSuccess("新增成功"),e.openProcurement=!1,e.resetQuery()})):(e.$modal.msgSuccess("新增成功"),e.openProcurement=!1,e.resetQuery())})).catch((function(){})).finally((function(){e.procurementSubmitting=!1}))}}))},fetchInboundShippingSuggestions:function(e,n){var t=String(e||"").trim().toLowerCase();Object(h["c"])({shippingType:1,pageNum:1,pageSize:50}).then((function(e){var r=e.rows||[],o=r.map((function(e){var n=e&&e.purchaseOrderNo;return n?Object(s["g"])({purchaseOrderNo:n,pageNum:1,pageSize:1}).then((function(n){var t=(n.rows||[])[0],r=t?t.auditStatus:null;return{row:e,status:r}})).catch((function(){return{row:e,status:null}})):Promise.resolve({row:e,status:null})}));Promise.all(o).then((function(e){var r=e.filter((function(e){return e.row&&3===e.status})),o=r.map((function(e){return e.row})).filter((function(e){if(!t)return!0;var n=String(e.trackingNo||"").toLowerCase(),r=String(e.purchaseOrderNo||"").toLowerCase();return n.includes(t)||r.includes(t)})).slice(0,20).map((function(e){return{value:e.trackingNo||"",trackingNo:e.trackingNo||"",purchaseOrderNo:e.purchaseOrderNo||""}}));n(o)})).catch((function(){return n([])}))})).catch((function(){return n([])}))},onInboundShippingSelect:function(e){this.procurementForm.inboundShippingQuery=e&&e.value?e.value:"",this.selectedInboundShippingTrackingNo=e&&e.trackingNo?e.trackingNo:"",this.selectedInboundShippingPO=e&&e.purchaseOrderNo?e.purchaseOrderNo:"",this.selectedInboundShippingPO&&this.setSelectedProcurementByPurchaseOrderNo(this.selectedInboundShippingPO)},setSelectedProcurementByPurchaseOrderNo:function(e){var n=this;e?Object(s["g"])({purchaseOrderNo:e,pageNum:1,pageSize:1}).then((function(e){var t=(e.rows||[])[0];t&&t.procurementPlanId?(n.procurementPlanOptions=[t],n.selectedProcurementPlanId=t.procurementPlanId,n.poSearch="".concat(t.procurementPlanName||"采购计划").concat(t.purchaseOrderNo?" - "+t.purchaseOrderNo:""),n.onProcurementPlanChange(t.procurementPlanId),n.lockPOByShipping=!0):(n.lockPOByShipping=!1,n.$modal&&n.$modal.msgWarning("未找到运输单关联的采购单"))})).catch((function(){n.lockPOByShipping=!1})):this.lockPOByShipping=!1},cancelProcurement:function(){this.openProcurement=!1,this.resetProcurementForm()},resetProcurementForm:function(){this.procurementForm={inboundShippingQuery:"",inventoryName:null,inventoryNum:null,inventoryPrice:null,inventoryUnit:null,remark:null},this.selectedProcurementPlanId=null,this.lockedByPlan=!0,this.poSearch="",this.resetForm("procurementFormRef")},fetchProductionPlans:function(){var e=this;this.productionPlanLoading=!0,Object(m["d"])({status:2,pageNum:1,pageSize:1e3}).then((function(n){var t=n.rows||[];e.productionPlanOptions=t})).finally((function(){e.productionPlanLoading=!1}))},fetchProductionPlanSuggestions:function(e,n){var t=this,r=(e||"").trim();this.productionPlanLoading=!0;var o=r?{status:2,planName:r,workOrderNo:r,pageNum:1,pageSize:20}:{status:2,pageNum:1,pageSize:20};Object(m["d"])(o).then((function(e){var t=e.rows||[],r=t.map((function(e){return{value:"".concat(e.workOrderNo?e.workOrderNo:"工单号").concat(e.planName?" - "+e.planName:""),planId:e.planId,workOrderNo:e.workOrderNo||""}}));n(r)})).finally((function(){t.productionPlanLoading=!1}))},handleHistory:function(e){var n=this;if(e){this.historyTitle="库存历史 - ".concat(e.inventoryName||""),this.openHistory=!0,this.historyLoading=!0;var t=Object(c["b"])({warehouseWarrantName:e.inventoryName,pageNum:1,pageSize:100}),r=Object(u["d"])({warehouseDeliveryName:e.inventoryName,pageNum:1,pageSize:100});Promise.all([t,r]).then((function(e){var t=Object(a["a"])(e,2),r=t[0],o=t[1],i=(r.rows||[]).map((function(e){return{type:"入库",name:e.warehouseWarrantName,num:e.warehouseWarrantNum,unit:e.unit,remark:e.remark,time:e.createTime}})),l=(o.rows||[]).map((function(e){return{type:"出库",name:e.warehouseDeliveryName,num:e.warehouseDeliveryNum,unit:e.unit,remark:e.remark,time:e.createTime}})),u=i.concat(l);u.sort((function(e,n){return new Date(e.time).getTime()-new Date(n.time).getTime()})),n.historyEntries=u})).catch((function(){n.historyEntries=[]})).finally((function(){n.historyLoading=!1}))}},onProductionSuggestionSelect:function(e){var n=e&&e.planId;this.selectedProductionPlanId=n||null,this.prodSearch=e&&e.value||"",n&&this.onProductionPlanChange(n)},onProductionPlanChange:function(e){var n=this;this.lockedByProductionPlan=!!e;var t=this.productionPlanOptions.find((function(n){return n.planId===e})),r=function(e){e&&(n.productionForm.inventoryNum=e.productionNum,n.productionForm.inventoryName=e.planName||n.productionForm.inventoryName)};t?r(t):e&&Object(m["c"])(e).then((function(e){return r(e.data||{})}))},submitProductionForm:function(){var e=this;this.productionSubmitting||this.$refs["productionFormRef"].validate((function(n){if(n){e.productionSubmitting=!0;var t=e.productionForm.remark,r=t||"",o={inventoryName:e.productionForm.inventoryName,inventoryNum:e.productionForm.inventoryNum,inventoryUnit:e.productionForm.inventoryUnit,remark:r,finishedProductId:null};Object(l["a"])(o).then((function(){var n={warehouseWarrantName:e.productionForm.inventoryName,warehouseWarrantNum:e.productionForm.inventoryNum,warehouseWarrantPrice:null,unit:e.productionForm.inventoryUnit,remark:r};Object(c["a"])(n).catch((function(){}));var t=e.selectedProductionPlanId;t?Object(m["f"])({planId:t,status:3}).then((function(){e.$modal.msgSuccess("生产入库成功，生产单已完成"),e.openProduction=!1,e.getList()})).catch((function(){e.$modal.msgSuccess("生产入库成功"),e.openProduction=!1,e.getList()})):(e.$modal.msgSuccess("生产入库成功"),e.openProduction=!1,e.getList())})).catch((function(){})).finally((function(){e.productionSubmitting=!1}))}}))},cancelProduction:function(){this.openProduction=!1,this.resetProductionForm()},resetProductionForm:function(){this.productionForm={inventoryName:null,inventoryNum:null,inventoryUnit:null,remark:null},this.selectedProductionPlanId=null,this.lockedByProductionPlan=!0,this.prodSearch="",this.resetForm("productionFormRef")},handleUpdate:function(e){var n=this;this.reset();var t=e.inventoryId||this.ids;Object(l["e"])(t).then((function(e){n.form=e.data,n.open=!0,n.title="修改"+n.inventoryPageTitle}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(n){n&&(null!=e.form.inventoryId?Object(l["h"])(e.form).then((function(n){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList()})):Object(l["a"])(e.form).then((function(n){e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList()})))}))},handleDelete:function(e){var n=this,t=e.inventoryId||this.ids;this.$modal.confirm("是否确认删除"+this.inventoryPageTitle+'编号为"'+t+'"的数据项？').then((function(){return Object(l["c"])(t)})).then((function(){n.getList(),n.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("production/supplierInventory/export",Object(i["a"])({},this.queryParams),"inventory_".concat((new Date).getTime(),".xlsx"))},fetchTypeDictionaries:function(){var e=this;Object(d["a"])({pageNum:1,pageSize:9999}).then((function(n){e.materialsClassifyOptions=n.rows||[]})).catch((function(){}))},typeName:function(e){return e&&e.itemId?this.typeNameDict["mat:"+e.itemId]||"配件":"-"},resolveTypeNames:function(e){var n=this,t=Array.from(new Set((e||[]).map((function(e){return e.itemId})).filter(Boolean))),r=t.map((function(e){return Object(p["a"])(e).then((function(t){var r=t&&t.data?t.data:{},o=r.accessoryClassifyId,i="配件";if(o){var a=n.materialsClassifyOptions.find((function(e){return e.accessoryClassifyId===o}));a&&(i=a.accessoryClassifyName)}n.$set(n.typeNameDict,"mat:"+e,i)})).catch((function(){n.$set(n.typeNameDict,"mat:"+e,"配件")}))}));Promise.all(r).catch((function(){}))}}},v=y,f=t("2877"),P=t("2246"),b=t.n(P),g=Object(f["a"])(v,r,o,!1,null,null,null);"function"===typeof b.a&&b()(g);n["default"]=g.exports},fba1:function(e,n,t){"use strict";t.d(n,"d",(function(){return o})),t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){return a})),t.d(n,"e",(function(){return l})),t.d(n,"b",(function(){return u}));var r=t("b775");function o(e){return Object(r["a"])({url:"/warehouseDelivery/warehouseDelivery/list",method:"get",params:e})}function i(e){return Object(r["a"])({url:"/warehouseDelivery/warehouseDelivery/"+e,method:"get"})}function a(e){return Object(r["a"])({url:"/warehouseDelivery/warehouseDelivery",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/warehouseDelivery/warehouseDelivery",method:"put",data:e})}function u(e){return Object(r["a"])({url:"/warehouseDelivery/warehouseDelivery/"+e,method:"delete"})}}}]);