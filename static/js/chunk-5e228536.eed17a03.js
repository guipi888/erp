(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e228536"],{"9fb7":function(e,t,r){"use strict";r("e3da")},d2fc:function(e,t,r){"use strict";r.d(t,"g",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"f",(function(){return a})),r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return s})),r.d(t,"h",(function(){return c})),r.d(t,"e",(function(){return d}));var n=r("b775");function o(e){return Object(n["a"])({url:"/supplier/supplier/list",method:"get",params:e})}function i(){return Object(n["a"])({url:"/supplier/supplier/approverList",method:"get"})}function a(e){return Object(n["a"])({url:"/supplier/supplier/"+e,method:"get"})}function l(e){return Object(n["a"])({url:"/supplier/supplier",method:"post",data:e})}function u(e){return Object(n["a"])({url:"/supplier/supplier/approver",method:"put",data:e})}function s(e){return Object(n["a"])({url:"/supplier/supplier/audit",method:"put",data:e})}function c(e){return Object(n["a"])({url:"/supplier/supplier",method:"put",data:e})}function d(e){return Object(n["a"])({url:"/supplier/supplier/"+e,method:"delete"})}},d4de:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[r("el-form-item",{attrs:{label:"供应商",prop:"supplierId"}},[r("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"请选择供应商",clearable:"",filterable:"",size:"small"},on:{change:e.handleQuery},model:{value:e.queryParams.supplierId,callback:function(t){e.$set(e.queryParams,"supplierId",t)},expression:"queryParams.supplierId"}},e._l(e.supplierOptions,(function(e){return r("el-option",{key:e.supplierId,attrs:{label:e.supplierName,value:e.supplierId}})})),1)],1),r("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[r("el-input",{attrs:{placeholder:"请输入"+e.inventoryNameLabel,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.inventoryName,callback:function(t){e.$set(e.queryParams,"inventoryName",t)},expression:"queryParams.inventoryName"}})],1),r("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[r("el-input",{attrs:{placeholder:"请输入数量",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.inventoryNum,callback:function(t){e.$set(e.queryParams,"inventoryNum",t)},expression:"queryParams.inventoryNum"}})],1),r("el-form-item",{attrs:{label:"价格",prop:"inventoryPrice"}},[r("el-input",{attrs:{placeholder:"请输入价格",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.inventoryPrice,callback:function(t){e.$set(e.queryParams,"inventoryPrice",t)},expression:"queryParams.inventoryPrice"}})],1),r("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[r("el-input",{attrs:{placeholder:"请输入单位",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.inventoryUnit,callback:function(t){e.$set(e.queryParams,"inventoryUnit",t)},expression:"queryParams.inventoryUnit"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),r("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),r("el-row",{staticClass:"mb8",attrs:{gutter:10}},[r("el-col",{attrs:{span:2}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:add"],expression:"['Inventory:inventory:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("入库")])],1),r("el-col",{attrs:{span:2}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:edit"],expression:"['Inventory:inventory:edit']"}],attrs:{type:"success",plain:"",icon:"el-icon-edit",size:"mini",disabled:e.single},on:{click:e.handleUpdate}},[e._v("修改")])],1),r("el-col",{attrs:{span:2}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:remove"],expression:"['Inventory:inventory:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("删除")])],1),r("el-col",{attrs:{span:2}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:export"],expression:"['Inventory:inventory:export']"}],attrs:{type:"warning",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleExport}},[e._v("导出")])],1),r("right-toolbar",{attrs:{"show-search":e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.inventoryList},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),r("el-table-column",{attrs:{label:e.inventoryNameLabel,align:"center",prop:"inventoryName"}}),r("el-table-column",{attrs:{label:"数量",align:"center",prop:"inventoryNum"}}),r("el-table-column",{attrs:{label:"价格",align:"center",prop:"inventoryPrice"}}),r("el-table-column",{attrs:{label:"单位",align:"center",prop:"inventoryUnit"}}),r("el-table-column",{attrs:{label:"类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.typeName(t.row)))])]}}])}),r("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),r("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:edit"],expression:"['Inventory:inventory:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(r){return e.handleUpdate(t.row)}}},[e._v("修改")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:remove"],expression:"['Inventory:inventory:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:pull"],expression:"['Inventory:inventory:pull']"}],attrs:{size:"mini",type:"text",icon:"el-icon-s-claim"},on:{click:function(r){return e.handlePull(t.row)}}},[e._v("申领")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["Inventory:inventory:query"],expression:"['Inventory:inventory:query']"}],attrs:{size:"mini",type:"text",icon:"el-icon-time"},on:{click:function(r){return e.handleHistory(t.row)}}},[e._v("查看历史")])]}}])})],1),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),r("el-dialog",{attrs:{title:e.addTitle,visible:e.openAdd,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.openAdd=t}}},[r("el-form",{ref:"addFormRef",attrs:{model:e.addForm,rules:e.addRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"入库类型",prop:"type"}},[r("el-radio-group",{on:{change:e.onAddTypeChange},model:{value:e.addForm.type,callback:function(t){e.$set(e.addForm,"type",t)},expression:"addForm.type"}},[r("el-radio",{attrs:{label:"procurement"}},[e._v("采购入库")]),r("el-radio",{attrs:{label:"production"}},[e._v("完工入库")]),r("el-radio",{attrs:{label:"semi"}},[e._v("半成品入库")])],1)],1),"procurement"===e.addForm.type?[r("el-form-item",{attrs:{label:"运输单号",prop:"shippingKeyword"}},[r("el-autocomplete",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择运单号","fetch-suggestions":e.fetchInboundShippingSuggestions,debounce:300,"trigger-on-focus":!0,"prefix-icon":"el-icon-tickets"},on:{select:e.onInboundShippingSelect},model:{value:e.addForm.shippingKeyword,callback:function(t){e.$set(e.addForm,"shippingKeyword",t)},expression:"addForm.shippingKeyword"}})],1),r("el-form-item",{attrs:{label:"采购单"}},[r("el-autocomplete",{staticStyle:{width:"100%"},attrs:{placeholder:"输入采购计划名称或采购单号","fetch-suggestions":e.fetchProcurementPlanSuggestions,disabled:!0},model:{value:e.addForm.poSearch,callback:function(t){e.$set(e.addForm,"poSearch",t)},expression:"addForm.poSearch"}})],1)]:e._e(),"production"===e.addForm.type?[r("el-form-item",{attrs:{label:"生产单",prop:"prodSearch"}},[r("el-autocomplete",{staticStyle:{width:"100%"},attrs:{placeholder:"输入生产计划名称或生产单号","fetch-suggestions":e.fetchProductionPlanSuggestions,debounce:300,"trigger-on-focus":!0},on:{select:e.onProductionSuggestionSelect},model:{value:e.addForm.prodSearch,callback:function(t){e.$set(e.addForm,"prodSearch",t)},expression:"addForm.prodSearch"}})],1)]:e._e(),r("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[r("el-input",{attrs:{placeholder:"semi"===e.addForm.type?"请输入名称":"自动带入",disabled:"semi"!==e.addForm.type},model:{value:e.addForm.inventoryName,callback:function(t){e.$set(e.addForm,"inventoryName",t)},expression:"addForm.inventoryName"}})],1),r("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[r("el-input",{attrs:{placeholder:"semi"===e.addForm.type?"请输入数量":"自动带入",disabled:"semi"!==e.addForm.type,type:"number"},model:{value:e.addForm.inventoryNum,callback:function(t){e.$set(e.addForm,"inventoryNum",t)},expression:"addForm.inventoryNum"}})],1),"production"!==e.addForm.type?r("el-form-item",{attrs:{label:"价格",prop:"inventoryPrice"}},[r("el-input",{attrs:{placeholder:"semi"===e.addForm.type?"请输入价格":"自动带入",disabled:"procurement"===e.addForm.type},model:{value:e.addForm.inventoryPrice,callback:function(t){e.$set(e.addForm,"inventoryPrice",t)},expression:"addForm.inventoryPrice"}})],1):e._e(),r("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[r("el-input",{attrs:{placeholder:"semi"===e.addForm.type?"请输入单位":"自动带入",disabled:"semi"!==e.addForm.type},model:{value:e.addForm.inventoryUnit,callback:function(t){e.$set(e.addForm,"inventoryUnit",t)},expression:"addForm.inventoryUnit"}})],1),r("el-form-item",{attrs:{label:"备注",prop:"remark"}},[r("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1)],2),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:e.addSubmitting},on:{click:e.submitAddForm}},[e._v("确 定")]),r("el-button",{on:{click:e.cancelAdd}},[e._v("取 消")])],1)],1),r("el-dialog",{attrs:{title:e.title,visible:e.openPull,width:"520px","append-to-body":""},on:{"update:visible":function(t){e.openPull=t}}},[r("el-form",{ref:"form",attrs:{model:e.formPull,rules:e.rulesPull,"label-width":"102px"}},[r("el-form-item",{attrs:{label:"出库类型",prop:"outType"}},[r("el-radio-group",{model:{value:e.formPull.outType,callback:function(t){e.$set(e.formPull,"outType",t)},expression:"formPull.outType"}},[r("el-radio",{attrs:{label:1}},[e._v("生产领料")]),r("el-radio",{attrs:{label:2}},[e._v("调拨出库")])],1)],1),1===e.formPull.outType?r("el-form-item",{attrs:{label:"生产单",prop:"productionPlanId"}},[r("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"","remote-method":e.remoteSearchPullProduction,loading:e.pullProductionLoading,placeholder:"搜索生产单号或计划名称"},on:{change:e.onPullProductionChange},model:{value:e.formPull.productionPlanId,callback:function(t){e.$set(e.formPull,"productionPlanId",t)},expression:"formPull.productionPlanId"}},e._l(e.pullProductionOptions,(function(e){return r("el-option",{key:e.planId,attrs:{label:(e.workOrderNo?e.workOrderNo+" - ":"")+(e.planName||""),value:e.planId}})})),1)],1):e._e(),2===e.formPull.outType?r("el-form-item",{attrs:{label:"物流公司",prop:"logisticsCompany"}},[r("el-input",{attrs:{placeholder:"请输入物流公司"},model:{value:e.formPull.logisticsCompany,callback:function(t){e.$set(e.formPull,"logisticsCompany",t)},expression:"formPull.logisticsCompany"}})],1):e._e(),2===e.formPull.outType?r("el-form-item",{attrs:{label:"运单号",prop:"trackingNo"}},[r("el-input",{attrs:{placeholder:"请输入运单号"},model:{value:e.formPull.trackingNo,callback:function(t){e.$set(e.formPull,"trackingNo",t)},expression:"formPull.trackingNo"}})],1):e._e(),r("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入数量"},model:{value:e.formPull.inventoryNum,callback:function(t){e.$set(e.formPull,"inventoryNum",t)},expression:"formPull.inventoryNum"}})],1),r("el-form-item",{attrs:{label:"备注",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注",maxlength:"500","show-word-limit":"",rows:3},model:{value:e.formPull.remark,callback:function(t){e.$set(e.formPull,"remark",t)},expression:"formPull.remark"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitFormPull}},[e._v("确 定")]),r("el-button",{on:{click:e.cancelPull}},[e._v("取 消")])],1)],1),r("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:e.inventoryNameLabel,prop:"inventoryName"}},[r("el-input",{attrs:{placeholder:"请输入"+e.inventoryNameLabel},model:{value:e.form.inventoryName,callback:function(t){e.$set(e.form,"inventoryName",t)},expression:"form.inventoryName"}})],1),r("el-form-item",{attrs:{label:"数量",prop:"inventoryNum"}},[r("el-input",{attrs:{placeholder:"请输入数量"},model:{value:e.form.inventoryNum,callback:function(t){e.$set(e.form,"inventoryNum",t)},expression:"form.inventoryNum"}})],1),r("el-form-item",{attrs:{label:"价格",prop:"inventoryPrice"}},[r("el-input",{attrs:{placeholder:"请输入价格"},model:{value:e.form.inventoryPrice,callback:function(t){e.$set(e.form,"inventoryPrice",t)},expression:"form.inventoryPrice"}})],1),r("el-form-item",{attrs:{label:"单位",prop:"inventoryUnit"}},[r("el-input",{attrs:{placeholder:"请输入单位"},model:{value:e.form.inventoryUnit,callback:function(t){e.$set(e.form,"inventoryUnit",t)},expression:"form.inventoryUnit"}})],1),r("el-form-item",{attrs:{label:"备注",prop:"remark"}},[r("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),r("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),r("el-dialog",{attrs:{title:e.historyTitle,visible:e.openHistory,width:"900px","append-to-body":""},on:{"update:visible":function(t){e.openHistory=t}}},[r("div",{staticStyle:{"margin-bottom":"10px",display:"flex","justify-content":"flex-end"}},[r("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:"搜索名称/备注/操作人",clearable:"",size:"small","prefix-icon":"el-icon-search"},on:{input:e.handleHistoryQuery},model:{value:e.historyQueryParams.keyword,callback:function(t){e.$set(e.historyQueryParams,"keyword",t)},expression:"historyQueryParams.keyword"}})],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.historyLoading,expression:"historyLoading"}],attrs:{data:e.historyEntries,height:"500"}},[r("el-table-column",{attrs:{label:"时间",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.parseTime(t.row.time)))])]}}])}),r("el-table-column",{attrs:{label:"操作类型",align:"center",prop:"type",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:"入库"===t.row.type?"success":"warning"}},[e._v(e._s(t.row.type))])]}}])}),r("el-table-column",{attrs:{label:"名称",align:"center",prop:"name",sortable:"","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{label:"数量",align:"center",prop:"num",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{style:{color:"出库"===t.row.type?"#F56C6C":"#67C23A",fontWeight:"bold"}},[e._v(" "+e._s("出库"===t.row.type?"-":"+")+e._s(t.row.num)+" ")])]}}])}),r("el-table-column",{attrs:{label:"单位",align:"center",prop:"unit",width:"80"}}),r("el-table-column",{attrs:{label:"操作人",align:"center",prop:"operator",width:"100","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark","show-overflow-tooltip":""}})],1),r("div",{staticStyle:{"text-align":"right","margin-top":"20px"}},[r("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.historyTotal,"current-page":e.historyQueryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":e.historyQueryParams.pageSize},on:{"update:currentPage":function(t){return e.$set(e.historyQueryParams,"pageNum",t)},"update:current-page":function(t){return e.$set(e.historyQueryParams,"pageNum",t)},"update:pageSize":function(t){return e.$set(e.historyQueryParams,"pageSize",t)},"update:page-size":function(t){return e.$set(e.historyQueryParams,"pageSize",t)},"size-change":e.filterHistory,"current-change":e.filterHistory}})],1)],1)],1)},o=[],i=r("5530"),a=r("3835"),l=(r("d9e2"),r("99af"),r("4de4"),r("7db0"),r("a630"),r("caad"),r("a15b"),r("d81d"),r("fb6a"),r("4e82"),r("b0c0"),r("a9e3"),r("f00c"),r("d3b7"),r("ac1f"),r("00b4"),r("6062"),r("2532"),r("3ca3"),r("498a"),r("0643"),r("2382"),r("fffc"),r("a573"),r("ddb0"),r("d2fc")),u=r("8da2"),s=r("b775");function c(e){return Object(s["a"])({url:"/supplierOutbound/supplierOutbound/list",method:"get",params:e})}function d(e){return Object(s["a"])({url:"/supplierOutbound/supplierOutbound",method:"post",data:e})}function p(e){return Object(s["a"])({url:"/supplierInbound/supplierInbound/list",method:"get",params:e})}function m(e){return Object(s["a"])({url:"/supplierInbound/supplierInbound",method:"post",data:e})}var y=r("8d7a"),h=r("e988"),f=r("2d7b"),v=r("2224"),g=r("b3a9"),P=r("55fd"),b={name:"SupplierInventory",data:function(){var e=this;return{openPull:!1,formPull:{supplierInventoryId:0,inventoryName:"",inventoryUnit:"",outType:1,productionPlanId:null,logisticsCompany:"",trackingNo:"",inventoryNum:null,currentNum:0,selectedWorkOrderNo:null,remark:""},openAdd:!1,addTitle:"新增入库",addForm:{type:"procurement",shippingKeyword:"",poSearch:"",prodSearch:"",procurementPlanId:null,productionPlanId:null,inventoryName:"",inventoryNum:"",inventoryPrice:"",inventoryUnit:"",remark:"",materialsId:null,moduleType:"production"},addSubmitting:!1,isLocked:!0,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,inventoryList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,supplierId:null,inventoryName:null,inventoryNum:null,inventoryPrice:null,inventoryUnit:null,supplierInboundId:null},form:{},rules:{},rulesPull:{outType:[{required:!0,message:"请选择出库类型",trigger:"change"}],inventoryNum:[{required:!0,message:"请输入数量",trigger:"blur"}],productionPlanId:[{required:!0,message:"请选择生产单",trigger:"change"}]},openProcurement:!1,procurementTitle:"",procurementPlanOptions:[],procurementPlanLoading:!1,selectedProcurementPlanId:null,poSearch:"",lockedByPlan:!0,procurementForm:{},procurementSubmitting:!1,procurementRules:{inboundShippingQuery:[{required:!0,message:"请选择运输单",trigger:"change"},{validator:function(t,r,n){e.selectedInboundShippingTrackingNo?n():n(new Error("请选择运输单"))},trigger:"change"}]},inboundShippingQuery:"",selectedInboundShippingTrackingNo:"",selectedInboundShippingPO:"",lockPOByShipping:!1,openProduction:!1,productionTitle:"",productionPlanOptions:[],productionPlanLoading:!1,selectedProductionPlanId:null,prodSearch:"",lockedByProductionPlan:!0,productionForm:{},productionRules:{inventoryNum:[{required:!0,message:"请输入数量",trigger:"blur"},{validator:function(e,t,r){var n=Number(t);!Number.isFinite(n)||n<=0?r(new Error("数量必须为正整数")):r()},trigger:"blur"}]},productionSubmitting:!1,pullProductionOptions:[],pullProductionLoading:!1,lockPullByProductionPlan:!1,materialsClassifyOptions:[],typeNameDict:{},historyTitle:"",openHistory:!1,historyLoading:!1,historyEntries:[],allHistoryEntries:[],historyTotal:0,historyQueryParams:{pageNum:1,pageSize:10,keyword:""},supplierOptions:[]}},created:function(){this.fetchSuppliers(),this.getList(),this.fetchTypeDictionaries()},computed:{addRules:function(){var e=this,t=this.addForm.type,r={inventoryNum:[{required:!0,message:"请输入数量",trigger:"blur"},{validator:function(e,t,r){var n=Number(t);!Number.isFinite(n)||n<=0?r(new Error("数量必须为正整数")):r()},trigger:"blur"}]};return"procurement"===t?r.shippingKeyword=[{required:!0,message:"请选择运输单",trigger:"change"},{validator:function(t,r,n){e.selectedInboundShippingTrackingNo?n():n(new Error("请选择运输单"))},trigger:"change"}]:"production"===t?r.prodSearch=[{required:!0,message:"请选择生产单",trigger:"change"}]:"semi"===t&&(r.inventoryName=[{required:!0,message:"请输入名称",trigger:"blur"}],r.inventoryUnit=[{required:!0,message:"请输入单位",trigger:"blur"}]),r},inventoryNameLabel:function(){var e=this.$route||{},t=String(e.path||""),r=e.query&&e.query.module,n=e.meta&&e.meta.module;r||n||/(production|supplier)/i.test(t)||/(warehouse)/i.test(t);return"供应商库存名称"},inventoryPageTitle:function(){return"供应商库存列表"}},methods:{parseTime:function(e){return Object(P["f"])(e)},$_addWarehouseDelivery:function(e){e&&e.supplierOutboundName&&e.supplierOutboundNum&&d(e).catch((function(){}))},submitFormPull:function(){var e=this,t=Number(this.formPull.inventoryNum||0),r=Number(this.formPull.currentNum||0);if(this.formPull.supplierInventoryId)if(1!==this.formPull.outType||this.formPull.productionPlanId)if(!Number.isFinite(t)||t<=0)this.$modal.msgError("请输入有效申领数量");else if(t>r)this.$modal.msgError("申领数量不能大于当前库存");else{var n={supplierInventoryId:this.formPull.supplierInventoryId,inventoryNum:r-t,remark:["出库类型:".concat(1===this.formPull.outType?"生产领料":"调拨出库")].join(" | ")};Object(u["updateSupplierInventory"])(n).then((function(){var r=e.formPull.remark?" | 备注:".concat(e.formPull.remark):"",n=["OUT","类型:".concat(1===e.formPull.outType?"生产领料":"调拨出库")].join(" | ")+r,o={supplierOutboundName:e.formPull.inventoryName,supplierOutboundNum:t,unit:e.formPull.inventoryUnit,remark:n,supplierInventoryId:e.formPull.supplierInventoryId,outboundType:1===e.formPull.outType?"生产领料":"调拨出库",productionOrderNo:1===e.formPull.outType?e.formPull.selectedWorkOrderNo:null,logisticsCompany:2===e.formPull.outType?e.formPull.logisticsCompany:null,trackingNo:2===e.formPull.outType?e.formPull.trackingNo:null};try{e.$_addWarehouseDelivery&&e.$_addWarehouseDelivery(o)}catch(i){}e.$modal.msgSuccess("申请成功"),e.openPull=!1,e.getList()}))}else this.$modal.msgError("请选择生产单");else this.$modal.msgError("缺少申领目标ID")},handlePull:function(e){this.formPull.supplierInventoryId=e.supplierInventoryId,this.formPull.inventoryName=e.inventoryName,this.formPull.inventoryUnit=e.inventoryUnit,this.formPull.currentNum=e.inventoryNum,this.formPull.inventoryNum=null,this.formPull.outType=1,this.formPull.productionPlanId=null,this.formPull.remark="",this.pullProductionOptions=[],this.lockPullByProductionPlan=!1,this.openPull=!0,this.title="申领窗口"},remoteSearchPullProduction:function(e){var t=this;e?(this.pullProductionLoading=!0,Object(h["d"])({params:{keyword:e},status:1,pageNum:1,pageSize:10}).then((function(e){var r=e.rows||[];t.pullProductionOptions=r.filter((function(e){return 1===e.status}))})).catch((function(){})).finally((function(){t.pullProductionLoading=!1}))):this.pullProductionOptions=[]},onPullProductionChange:function(e){var t=this.pullProductionOptions.find((function(t){return t.planId===e}));t?(this.formPull.inventoryNum=t.productionNum,this.formPull.selectedWorkOrderNo=t.workOrderNo,this.lockPullByProductionPlan=!0):(this.formPull.selectedWorkOrderNo=null,this.lockPullByProductionPlan=!1)},getList:function(){var e=this;this.loading=!0,Object(s["a"])({url:"/production/supplierInventory/production-list",method:"get",params:this.queryParams}).then((function(t){var r=t.rows||[];e.inventoryList=r,e.total=t.total,e.resolveTypeNames(e.inventoryList),e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},cancelPull:function(){this.openPull=!1},reset:function(){this.form={supplierInventoryId:null,inventoryName:null,inventoryNum:null,inventoryPrice:null,inventoryUnit:null,supplierInboundId:null,remark:null,createBy:null,createTime:null,updateBy:null,updateTime:null,moduleType:"production"},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.supplierInventoryId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.resetAddForm(),this.openAdd=!0,this.addTitle="新增入库","procurement"===this.addForm.type&&this.remoteSearchInboundPO("")},resetAddForm:function(){this.addForm={type:"procurement",shippingKeyword:"",poSearch:"",prodSearch:"",procurementPlanId:null,productionPlanId:null,inventoryName:"",inventoryNum:"",inventoryPrice:"",inventoryUnit:"",remark:"",moduleType:"production"},this.selectedProcurementPlanId=null,this.selectedProductionPlanId=null,this.selectedInboundShippingTrackingNo="",this.selectedInboundShippingPO="",this.isLocked=!0,this.resetForm("addFormRef")},onAddTypeChange:function(e){var t=e;this.resetAddForm(),this.addForm.type=t,"semi"===t?this.isLocked=!1:(this.isLocked=!0,"procurement"===t&&this.remoteSearchInboundPO(""),"production"===t&&this.fetchProductionPlans())},cancelAdd:function(){this.openAdd=!1,this.resetAddForm()},submitAddForm:function(){var e=this;this.addSubmitting||this.$refs["addFormRef"].validate((function(t){if(t){e.addSubmitting=!0;var r=e.addForm.type,n="",o=e.addForm.remark||"",i=null;if("procurement"===r){n="采购入库";var a=e.addForm.materialsId?"ITEM#".concat(e.addForm.materialsId):null,l=e.selectedInboundShippingTrackingNo?"SHIP#".concat(e.selectedInboundShippingTrackingNo):null,s=e.selectedInboundShippingPO?"PO#".concat(e.selectedInboundShippingPO):null;o=[a,l,s,o].filter(Boolean).join(" | ");var c=e.procurementPlanOptions.find((function(t){return t.procurementPlanId===e.selectedProcurementPlanId}));i=c?c.supplierId:null}else n="production"===r?"完工入库":"半成品入库";var d={inventoryName:e.addForm.inventoryName,inventoryNum:e.addForm.inventoryNum,inventoryPrice:e.addForm.inventoryPrice,inventoryUnit:e.addForm.inventoryUnit,remark:o,supplierInboundId:e.selectedProcurementPlanId,itemId:e.addForm.materialsId||null,supplierId:i,finishedProductId:null,moduleType:"production"};Object(u["addSupplierInventory"])(d).then((function(){var t={supplierInboundName:e.addForm.inventoryName,supplierInboundNum:e.addForm.inventoryNum,supplierInboundPrice:e.addForm.inventoryPrice,unit:e.addForm.inventoryUnit,remark:o,supplierId:i,inboundType:n};m(t).catch((function(){})),"procurement"===r&&e.selectedProcurementPlanId?Object(y["c"])({procurementPlanId:e.selectedProcurementPlanId}).catch((function(){})):"production"===r&&e.selectedProductionPlanId&&Object(h["f"])({planId:e.selectedProductionPlanId,status:3}).catch((function(){})),e.$modal.msgSuccess("新增成功"),e.openAdd=!1,e.getList()})).catch((function(){})).finally((function(){e.addSubmitting=!1}))}}))},remoteSearchInboundPO:function(e){var t=this,r=(e||"").trim();this.procurementPlanLoading=!0;var n=r?{auditStatus:2,procurementPlanName:r,purchaseOrderNo:r,pageNum:1,pageSize:9999}:{auditStatus:2,pageNum:1,pageSize:9999};Object(y["g"])(n).then((function(e){t.procurementPlanOptions=e.rows||[]})).finally((function(){t.procurementPlanLoading=!1}))},onInboundPOVisibleChange:function(e){e&&this.remoteSearchInboundPO("")},onProcurementPlanChange:function(e){var t=this,r=this.procurementPlanOptions.find((function(t){return t.procurementPlanId===e}));if(this.isLocked=!!e,r){this.addForm.inventoryNum=r.procurementPlanNum||this.addForm.inventoryNum,this.addForm.inventoryPrice=r.procurementPlanPrice||this.addForm.inventoryPrice;var n=r.lpMaterialId;this.addForm.materialsId=n||null,n?Object(f["a"])(n).then((function(e){var n=e&&e.data?e.data:{};t.addForm.inventoryName=n.accessoryName||t.addForm.inventoryName,t.addForm.inventoryUnit=r.unit||n.unit||t.addForm.inventoryUnit})):this.addForm.inventoryUnit=r.unit||this.addForm.inventoryUnit}},fetchInboundShippingSuggestions:function(e,t){var r=String(e||"").trim().toLowerCase();Object(g["c"])({shippingType:1,pageNum:1,pageSize:50}).then((function(e){var n=e.rows||[],o=n.map((function(e){var t=e&&e.purchaseOrderNo;return t?Object(y["g"])({purchaseOrderNo:t,pageNum:1,pageSize:1}).then((function(t){var r=(t.rows||[])[0],n=r?r.auditStatus:null;return{row:e,status:n}})).catch((function(){return{row:e,status:null}})):Promise.resolve({row:e,status:null})}));Promise.all(o).then((function(e){var n=e.filter((function(e){return e.row&&3===e.status})),o=n.map((function(e){return e.row})).filter((function(e){if(!r)return!0;var t=String(e.trackingNo||"").toLowerCase(),n=String(e.purchaseOrderNo||"").toLowerCase();return t.includes(r)||n.includes(r)})).slice(0,20).map((function(e){return{value:e.trackingNo||"",trackingNo:e.trackingNo||"",purchaseOrderNo:e.purchaseOrderNo||""}}));t(o)})).catch((function(){return t([])}))})).catch((function(){return t([])}))},onInboundShippingSelect:function(e){this.addForm.shippingKeyword=e&&e.value?e.value:"",this.selectedInboundShippingTrackingNo=e&&e.trackingNo?e.trackingNo:"",this.selectedInboundShippingPO=e&&e.purchaseOrderNo?e.purchaseOrderNo:"",this.selectedInboundShippingPO&&this.setSelectedProcurementByPurchaseOrderNo(this.selectedInboundShippingPO)},setSelectedProcurementByPurchaseOrderNo:function(e){var t=this;e?Object(y["g"])({purchaseOrderNo:e,pageNum:1,pageSize:1}).then((function(e){var r=(e.rows||[])[0];r&&r.procurementPlanId?(t.procurementPlanOptions=[r],t.selectedProcurementPlanId=r.procurementPlanId,t.addForm.poSearch="".concat(r.procurementPlanName||"采购计划").concat(r.purchaseOrderNo?" - "+r.purchaseOrderNo:""),t.onProcurementPlanChange(r.procurementPlanId),t.lockPOByShipping=!0):(t.lockPOByShipping=!1,t.$modal&&t.$modal.msgWarning("未找到运输单关联的采购单"))})).catch((function(){t.lockPOByShipping=!1})):this.lockPOByShipping=!1},fetchProductionPlans:function(){var e=this;this.productionPlanLoading=!0,Object(h["d"])({status:2,pageNum:1,pageSize:1e3}).then((function(t){var r=t.rows||[];e.productionPlanOptions=r})).finally((function(){e.productionPlanLoading=!1}))},fetchProductionPlanSuggestions:function(e,t){var r=this,n=(e||"").trim();this.productionPlanLoading=!0;var o=n?{status:2,planName:n,workOrderNo:n,pageNum:1,pageSize:20}:{status:2,pageNum:1,pageSize:20};Object(h["d"])(o).then((function(e){var r=e.rows||[],n=r.map((function(e){return{value:"".concat(e.workOrderNo?e.workOrderNo:"工单号").concat(e.planName?" - "+e.planName:""),planId:e.planId,workOrderNo:e.workOrderNo||""}}));t(n)})).finally((function(){r.productionPlanLoading=!1}))},handleHistory:function(e){var t=this;if(e){this.historyTitle="库存历史 - ".concat(e.inventoryName||""),this.openHistory=!0,this.historyLoading=!0,this.historyQueryParams={pageNum:1,pageSize:10,keyword:""};var r=p({supplierInboundName:e.inventoryName,pageNum:1,pageSize:1e3}),n=c({supplierOutboundName:e.inventoryName,pageNum:1,pageSize:1e3});Promise.all([r,n]).then((function(e){var r=Object(a["a"])(e,2),n=r[0],o=r[1],i=(n.rows||[]).map((function(e){return{type:"入库",name:e.supplierInboundName,num:e.supplierInboundNum,unit:e.unit,price:e.supplierInboundPrice,remark:e.remark,time:e.createTime,operator:e.createBy||e.auditPerson||"-"}})),l=(o.rows||[]).map((function(e){return{type:"出库",name:e.supplierOutboundName,num:e.supplierOutboundNum,unit:e.unit,price:e.supplierOutboundPrice||null,remark:e.remark,time:e.createTime,operator:e.createBy||"-"}})),u=i.concat(l);u.sort((function(e,t){return new Date(t.time).getTime()-new Date(e.time).getTime()})),t.allHistoryEntries=u,t.filterHistory()})).catch((function(){t.allHistoryEntries=[],t.historyEntries=[],t.historyTotal=0})).finally((function(){t.historyLoading=!1}))}},filterHistory:function(){var e=this.historyQueryParams,t=e.pageNum,r=e.pageSize,n=e.keyword,o=this.allHistoryEntries;if(n){var i=n.toLowerCase();o=o.filter((function(e){return e.name&&e.name.toLowerCase().includes(i)||e.remark&&e.remark.toLowerCase().includes(i)||e.operator&&e.operator.toLowerCase().includes(i)||e.type&&e.type.includes(i)}))}this.historyTotal=o.length;var a=(t-1)*r,l=a+r;this.historyEntries=o.slice(a,l)},handleHistoryQuery:function(){this.historyQueryParams.pageNum=1,this.filterHistory()},onProductionSuggestionSelect:function(e){var t=e&&e.planId;this.selectedProductionPlanId=t||null,this.addForm.prodSearch=e&&e.value||"",t&&this.onProductionPlanChange(t)},onProductionPlanChange:function(e){var t=this;this.isLocked=!!e;var r=this.productionPlanOptions.find((function(t){return t.planId===e})),n=function(e){e&&(t.addForm.inventoryNum=e.productionNum,t.addForm.inventoryName=e.finishedProductName||e.planName||t.addForm.inventoryName,t.addForm.materialsId=e.finishedProductId||null,t.addForm.inventoryUnit=e.unit||t.addForm.inventoryUnit)};r?n(r):e&&Object(h["c"])(e).then((function(e){return n(e.data||{})}))},handleUpdate:function(e){var t=this;this.reset();var r=e.supplierInventoryId||this.ids;Object(u["getSupplierInventory"])(r).then((function(e){t.form=e.data,t.open=!0,t.title="修改"+t.inventoryPageTitle}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(null!=e.form.supplierInventoryId?Object(u["updateSupplierInventory"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList()})):Object(u["addSupplierInventory"])(e.form).then((function(t){var r={supplierInboundName:e.form.inventoryName,supplierInboundNum:e.form.inventoryNum,supplierInboundPrice:e.form.inventoryPrice,unit:e.form.inventoryUnit,remark:e.form.remark,inboundType:"半成品入库"};try{m(r)}catch(n){}e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList()})))}))},handleDelete:function(e){var t=this,r=e.supplierInventoryId||this.ids;this.$modal.confirm("是否确认删除"+this.inventoryPageTitle+'编号为"'+r+'"的数据项？').then((function(){return Object(u["delSupplierInventory"])(r)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("production/supplierInventory/export",Object(i["a"])({},this.queryParams),"supplierInventory_".concat((new Date).getTime(),".xlsx"))},fetchTypeDictionaries:function(){var e=this;Object(v["a"])({pageNum:1,pageSize:9999}).then((function(t){e.materialsClassifyOptions=t.rows||[]})).catch((function(){}))},fetchSuppliers:function(){var e=this;Object(l["g"])({pageNum:1,pageSize:9999}).then((function(t){e.supplierOptions=t.rows||[]}))},typeName:function(e){return e&&e.itemId?this.typeNameDict["mat:"+e.itemId]||"配件":"-"},resolveTypeNames:function(e){var t=this,r=Array.from(new Set((e||[]).map((function(e){return e.itemId})).filter(Boolean))),n=r.map((function(e){return Object(f["a"])(e).then((function(r){var n=r&&r.data?r.data:{},o=n.accessoryClassifyId,i="配件";if(o){var a=t.materialsClassifyOptions.find((function(e){return e.accessoryClassifyId===o}));a&&(i=a.accessoryClassifyName)}t.$set(t.typeNameDict,"mat:"+e,i)})).catch((function(){t.$set(t.typeNameDict,"mat:"+e,"配件")}))}));Promise.all(n).catch((function(){}))},fetchProcurementPlanSuggestions:function(e,t){var r=this,n=(e||"").trim();this.procurementPlanLoading=!0;var o=n?{auditStatus:2,procurementPlanName:n,purchaseOrderNo:n,pageNum:1,pageSize:20}:{auditStatus:2,pageNum:1,pageSize:20};Object(y["g"])(o).then((function(e){var r=e.rows||[],n=r.map((function(e){return{value:"".concat(e.procurementPlanName||"采购计划").concat(e.purchaseOrderNo?" - "+e.purchaseOrderNo:""),procurementPlanId:e.procurementPlanId,purchaseOrderNo:e.purchaseOrderNo||""}}));t(n)})).finally((function(){r.procurementPlanLoading=!1}))},onProcurementSuggestionSelect:function(e){var t=e&&e.procurementPlanId;this.selectedProcurementPlanId=t||null,this.addForm.poSearch=e&&e.value?e.value:"",t&&this.onProcurementPlanChange(t)}}},N=b,k=(r("9fb7"),r("2877")),I=Object(k["a"])(N,n,o,!1,null,"09bc518a",null);t["default"]=I.exports},e3da:function(e,t,r){}}]);